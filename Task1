
#!/bin/bash

BACKUP_SOURCE="/"
BACKUP_DEST="/media/usbdrive/backup" # Change this to your USB drive mount point
LOG_FILE="/var/log/backup.log"
EXCLUDE_FILE="/etc/backup_exclude.txt"

# Check if USB drive is mounted
if [ ! -d "$BACKUP_DEST" ]; then
  echo "USB drive not mounted at $BACKUP_DEST. Exiting."
  exit 1
fi

# Create exclude file if it doesn't exist
if [ ! -f "$EXCLUDE_FILE" ]; then
  cat <<EOF > "$EXCLUDE_FILE"
  /proc
  /tmp
  /mnt
  /media
  /dev
  /sys
  /run
  /var/tmp
  /lost+found
  /media/usbdrive
EOF
fi

# Create log file if it doesn't exist
if [ ! -f "$LOG_FILE" ]; then
  touch "$LOG_FILE"
fi

rsync -avh --delete --exclude-from="$EXCLUDE_FILE" "$BACKUP_SOURCE" "$BACKUP_DEST" >> "$LOG_FILE" 2>&1

echo "Backup completed on $(date)" >> "$LOG_FILE"
